import{d as F,I as C,X as M,a2 as x,M as T,T as V,S as E,a3 as v,a0 as L,L as U,O as R,P as $,W as D,Y as I,a4 as b,r as p,v as S,x as o,f as a,w as s,F as B,o as A,Q as O,U as j,V as r}from"./vendor.788096f7.js";import{_ as z}from"./index.2b50ce85.js";const N=F({name:"webcam-face-detection",data(){return{detection:"landmark",showModal:!0,facesContainer:null,showLoading:!1,facevalue:"ssdMobilenetv1",faces:[{label:"SSD Mobilenet V1",value:"ssdMobilenetv1"},{label:"Tiny Face Detector",value:"tinyFaceDetector"}],options:null,inputVideo:null,canvas:null,timeout:null,constraints:{audio:!1,video:{width:{min:320,ideal:1280,max:1920},height:{min:240,ideal:720,max:1080},frameRate:{min:15,ideal:30,max:60},facingMode:"environment"}},download:!1,withBox:!1,detectFace:"detectAllFaces"}},watch:{detection(e){this.inputVideo.pause(),setTimeout(()=>{this.inputVideo.play(),setTimeout(()=>this.updateResults(),100)},100)},facevalue(e){this.fnInit(),this.updateResults()},detectFace(e){this.updateResults()},"constraints.video.facingMode":{handler(e){this.updateResults()}}},mounted(){this.$nextTick(()=>{this.fnInit()}),this.$message=C(),this.inputVideo=document.getElementById("myVideo"),this.canvas=document.getElementById("overlay"),this.facesContainer=document.getElementById("facesContainer")},methods:{async fnInit(){switch(this.showLoading=!0,await M("/models"),await x("/models"),this.facevalue){case"ssdMobilenetv1":this.options=new E({minConfidence:.5});break;case"tinyFaceDetector":this.options=new V({inputSize:512,scoreThreshold:.5});break;case"mtcnn":this.options=new T({minFaceSize:20,scaleFactor:.709});break}this.showLoading=!1},handleUpdateChecked(e){this.download=e},handleChecked(e){this.withBox=e},displayExtractedFaces(e){const{canvas:t,inputVideo:h,facesContainer:l}=this;l.children.length>50&&(l.innerHTML=""),e.forEach(m=>{if(m.style.margin="10px",l.append(m),this.download){var w=m.toDataURL("image/png"),n=document.createElement("a"),c=new MouseEvent("click");n.download=new Date().getTime()||"\u4E0B\u8F7D\u56FE\u7247\u540D\u79F0",n.href=w,n.dispatchEvent(c)}})},fnOpen(){typeof window.stream!="object"&&(clearTimeout(this.timeout),this.timeout=setTimeout(()=>{clearTimeout(this.timeout),navigator.mediaDevices.getUserMedia(this.constraints).then(e=>{window.stream=e,this.inputVideo.srcObject=e,this.inputVideo.play()}).catch(()=>{this.$message.error("\u89C6\u9891\u5A92\u4F53\u6D41\u83B7\u53D6\u9519\u8BEF\uFF01")})},100))},fnClose(){this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.inputVideo.pause(),clearTimeout(this.timeout),typeof window.stream=="object"&&(window.stream.getTracks().forEach(e=>e.stop()),window.stream="",this.inputVideo.srcObject=null)},async updateResults(){const{canvas:e,inputVideo:t}=this;if(t.paused)return clearTimeout(this.timeout);let h=null;switch(this.detection){case"landmark":h=await v[this.detectFace](t,this.options).withFaceLandmarks();break;case"expression":h=await v[this.detectFace](t,this.options).withFaceLandmarks().withFaceExpressions();break;case"age_gender":h=await v[this.detectFace](t,this.options).withFaceLandmarks().withAgeAndGender();break;default:h=await v[this.detectFace](t,this.options);break}let l=await v[this.detectFace](t,this.options);l=l instanceof Array?l:[l];const m=await L(t,l);if(m.length&&this.displayExtractedFaces(m),h&&!t.paused){const w=U(e,t,!0),n=R(h,w);if(!this.withBox&&$(e,n),D(e,n),this.detection==="expression")I(e,n,.05);else if(this.detection==="age_gender")if(Array.isArray(n))n.forEach(c=>{const{age:f,gender:i,genderProbability:_}=c;new b([`${Math.round(f,0)} years`,`${i} (${Math.round(_)})`],c.detection.box.bottomLeft).draw(e)});else{const{age:c,gender:f,genderProbability:i}=n;new b([`${Math.round(c,0)} years`,`${f} (${Math.round(i)})`],n.detection.box.bottomLeft).draw(e)}}else e.getContext("2d").clearRect(0,0,e.width,e.height);this.timeout=setTimeout(()=>this.updateResults())}},beforeUnmount(){this.fnClose()}}),u=e=>(O("data-v-62722dd3"),e=e(),j(),e),P={style:{position:"relative"},class:"margin"},G={style:{width:"300px","margin-right":"10px"}},H=u(()=>o("h4",null,"\u89C6\u9891\u8F93\u5165",-1)),Q=r("\u542F\u52A8\u6444\u50CF\u5934"),W=r("\u7ED3\u675F\u6444\u50CF\u5934"),X=u(()=>o("h4",null,"\u5207\u6362\u6444\u50CF\u5934",-1)),Y=r("\u524D\u7F6E\u6444\u50CF\u5934"),q=r("\u540E\u7F6E\u6444\u50CF\u5934"),J=u(()=>o("h4",null,"\u68C0\u6D4B\u8BC6\u522B\u7C7B\u578B",-1)),K=r("\u8F6E\u5ED3\u68C0\u6D4B"),Z=r("\u8868\u60C5\u68C0\u6D4B"),ee=r("\u5E74\u9F84\u6027\u522B\u68C0\u6D4B"),te=u(()=>o("h4",null,"\u9009\u62E9\u4EBA\u8138\u68C0\u6D4B\u5668",-1)),ae=u(()=>o("h4",null,"\u89C6\u9891\u63A7\u5236",-1)),se=r("\u5355\u4EBA\u68C0\u6D4B"),ne=r("\u591A\u4EBA\u68C0\u6D4B"),oe=u(()=>o("h4",null,"\u4E0B\u8F7D\u63A7\u5236",-1)),ie={style:{position:"relative"}},de=u(()=>o("canvas",{id:"overlay"},null,-1)),le=u(()=>o("div",{id:"facesContainer"},null,-1)),ce=u(()=>o("div",{class:"loader"},"\u52A0\u8F7D\u4E2D...",-1));function re(e,t,h,l,m,w){const n=p("n-button"),c=p("n-checkbox"),f=p("n-divider"),i=p("n-radio"),_=p("n-space"),g=p("n-radio-group"),y=p("n-select"),k=p("n-modal");return A(),S(B,null,[o("div",P,[a(_,null,{default:s(()=>[o("div",G,[H,a(n,{onClick:e.fnOpen},{default:s(()=>[Q]),_:1},8,["onClick"]),a(n,{style:{"margin-left":"10px"},onClick:e.fnClose},{default:s(()=>[W]),_:1},8,["onClick"]),a(c,{style:{"margin-top":"10px"},"onUpdate:checked":e.handleChecked,label:"\u9690\u85CF\u8FB9\u754C\u6846"},null,8,["onUpdate:checked"]),a(f,{"title-placement":"left"}),X,a(g,{value:e.constraints.video.facingMode,"onUpdate:value":t[0]||(t[0]=d=>e.constraints.video.facingMode=d),name:"radiogroup"},{default:s(()=>[a(_,null,{default:s(()=>[a(i,{value:"user"},{default:s(()=>[Y]),_:1}),a(i,{value:"environment"},{default:s(()=>[q]),_:1})]),_:1})]),_:1},8,["value"]),a(f,{"title-placement":"left"}),J,a(g,{value:e.detection,"onUpdate:value":t[1]||(t[1]=d=>e.detection=d),name:"radiogroup"},{default:s(()=>[a(_,null,{default:s(()=>[a(i,{value:"landmark"},{default:s(()=>[K]),_:1}),a(i,{value:"expression"},{default:s(()=>[Z]),_:1}),a(i,{value:"age_gender"},{default:s(()=>[ee]),_:1})]),_:1})]),_:1},8,["value"]),a(f,{"title-placement":"left"}),te,a(y,{value:e.facevalue,"onUpdate:value":t[2]||(t[2]=d=>e.facevalue=d),options:e.faces},null,8,["value","options"]),ae,a(g,{value:e.detectFace,"onUpdate:value":t[3]||(t[3]=d=>e.detectFace=d),name:"radiogroup2"},{default:s(()=>[a(_,null,{default:s(()=>[a(i,{value:"detectSingleFace"},{default:s(()=>[se]),_:1}),a(i,{value:"detectAllFaces"},{default:s(()=>[ne]),_:1})]),_:1})]),_:1},8,["value"]),oe,a(c,{style:{"margin-top":"10px"},"onUpdate:checked":e.handleUpdateChecked,label:"\u542F\u7528\u4E0B\u8F7D"},null,8,["onUpdate:checked"])]),o("div",ie,[o("video",{id:"myVideo",poster:"https://dummyimage.com/1280x720",muted:"",loop:"",playsinline:"",onLoadedmetadata:t[4]||(t[4]=(...d)=>e.updateResults&&e.updateResults(...d))},null,32),de,le])]),_:1})]),a(k,{show:e.showLoading,"onUpdate:show":t[5]||(t[5]=d=>e.showLoading=d),"mask-closable":!1},{default:s(()=>[ce]),_:1},8,["show"])],64)}var pe=z(N,[["render",re],["__scopeId","data-v-62722dd3"]]);export{pe as default};
