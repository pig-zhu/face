import{d as I,I as y,M as C,T as m,S as v,n as _,J as D,K as j,L as F,O as M,P as S,r as o,v as k,f as s,w as i,o as U,x as n,Q as T,U as R,V as r}from"./vendor.788096f7.js";import{_ as L}from"./index.2b50ce85.js";const $=I({name:"face-detection",data(){return{showModal:!0,showLoading:!1,minConfidence:.5,scoreThreshold:.5,inputSize:512,imgUrl:"",fileList:[],selectvalue:"bbt1.jpg",facevalue:"ssdMobilenetv1",drawImg:"images/bbt1.jpg",defaultImgs:[{label:"bbt1.jpg",value:"bbt1.jpg"},{label:"bbt2.jpg",value:"bbt2.jpg"},{label:"bbt3.jpg",value:"bbt3.jpg"},{label:"bbt4.jpg",value:"bbt4.jpg"},{label:"bbt5.jpg",value:"bbt5.jpg"}],faces:[{label:"SSD Mobilenet V1",value:"ssdMobilenetv1"},{label:"Tiny Face Detector",value:"tinyFaceDetector"}],options:null}},watch:{selectvalue(e){this.drawImg=`images/${e}`,this.updateResults()},facevalue(e){this.fnInit(),this.updateResults()}},mounted(){this.$nextTick(()=>{this.fnInit().then(()=>this.updateResults())}),this.$message=y()},methods:{async fnInit(){switch(this.facevalue){case"ssdMobilenetv1":this.options=new v({minConfidence:.5});break;case"tinyFaceDetector":this.options=new m({inputSize:512,scoreThreshold:.5});break;case"mtcnn":this.options=new C({minFaceSize:20,scaleFactor:.709});break}},handleChange({event:e,file:t,fileList:a}){this.drawImg=URL.createObjectURL(t.file),this.updateResults(),this.fileList=a},handleUpdateChecked(){},async clickConfirm(){if(this.imgUrl){let e=await this.requestExternalImage(this.imgUrl);this.drawImg=e.src,this.updateResults()}},getCurrentFaceDetectionNet(){if(this.facevalue==="ssdMobilenetv1")return _.ssdMobilenetv1;if(this.facevalue==="tinyFaceDetector")return _.tinyFaceDetector},isFaceDetectionModelLoaded(){return!!this.getCurrentFaceDetectionNet().params},getFaceDetectorOptions(){return this.facevalue==="ssdMobilenetv1"?new v({minConfidence:this.minConfidence}):new m({inputSize:this.inputSize,scoreThreshold:this.scoreThreshold})},async requestExternalImage(e){let t=await fetch(e);try{let a=await t.blob();return await D(a)}catch{throw new Error("failed to load image from url: "+e)}},async updateResults(){if(!this.isFaceDetectionModelLoaded())return;const e=document.getElementById("inputImg"),t=this.getFaceDetectorOptions(),a=await j(e,t),c=document.getElementById("overlay");c.width=e.width,c.height=e.height,F(c,e);let u=M(a,e);u.length?S(c,u):this.$message.error("\u8FD9\u53EF\u80FD\u4E0D\u662F\u4E2A\u4EBA\uFF01")}}}),l=e=>(T("data-v-99905208"),e=e(),R(),e),E={style:{position:"relative"},class:"margin"},O={style:{width:"300px","margin-right":"10px"}},z=l(()=>n("h4",null,"\u56FE\u7247\u8F93\u5165",-1)),B=l(()=>n("label",{for:""},"\u9009\u62E9\u4E00\u4E2A\u7167\u7247\u5427\uFF1A",-1)),N=r("\u6216\u8005"),V=l(()=>n("label",{for:""},"\u8F93\u5165\u4E00\u4E2A\u56FE\u7247\u94FE\u63A5\uFF1A",-1)),x=r("\u786E\u5B9A"),q=r("\u6216\u8005"),A=l(()=>n("label",{for:""},"\u4ECE\u672C\u5730\u9009\u4E00\u5F20\u56FE\u7247\uFF1A",-1)),J=r("\u9009\u62E9\u6587\u4EF6"),K=l(()=>n("h4",null,"\u9009\u62E9\u4EBA\u8138\u68C0\u6D4B\u5668",-1)),P={style:{position:"relative"}},Q=["src"],G=l(()=>n("canvas",{id:"overlay"},null,-1));function H(e,t,a,c,u,W){const h=o("n-select"),p=o("n-divider"),b=o("n-input"),f=o("n-button"),g=o("n-upload"),w=o("n-space");return U(),k("div",E,[s(w,null,{default:i(()=>[n("div",O,[z,B,s(h,{value:e.selectvalue,"onUpdate:value":t[0]||(t[0]=d=>e.selectvalue=d),options:e.defaultImgs},null,8,["value","options"]),s(p,{"title-placement":"left"},{default:i(()=>[N]),_:1}),V,s(b,{value:e.imgUrl,"onUpdate:value":t[1]||(t[1]=d=>e.imgUrl=d),type:"text",placeholder:"\u56FE\u7247\u94FE\u63A5"},null,8,["value"]),s(f,{onClick:e.clickConfirm},{default:i(()=>[x]),_:1},8,["onClick"]),s(p,{"title-placement":"left"},{default:i(()=>[q]),_:1}),A,s(g,{onChange:e.handleChange,"default-upload":!1,ref:"upload"},{default:i(()=>[s(f,null,{default:i(()=>[J]),_:1})]),_:1},8,["onChange"]),s(p,{"title-placement":"left"}),K,s(h,{value:e.facevalue,"onUpdate:value":t[2]||(t[2]=d=>e.facevalue=d),options:e.faces},null,8,["value","options"])]),n("div",P,[n("img",{id:"inputImg",style:{width:"100%",border:"0"},src:e.drawImg},null,8,Q),G])]),_:1})])}var Z=L($,[["render",H],["__scopeId","data-v-99905208"]]);export{Z as default};
