import{d as F,I as E,M as j,T as g,S as v,n as _,J as D,L as b,K as w,a0 as M,O as U,P as x,W as S,r as i,v as T,f as s,w as c,o as L,x as n,Q as R,U as $,V as h}from"./vendor.788096f7.js";import{_ as O}from"./index.2b50ce85.js";const z=F({name:"face-extraction",data(){return{showModal:!0,showLoading:!1,checked:!1,minConfidence:.5,scoreThreshold:.5,inputSize:512,imgUrl:"",fileList:[],selectvalue:"bbt1.jpg",facevalue:"ssdMobilenetv1",drawImg:"/images/bbt1.jpg",defaultImgs:[{label:"bbt1.jpg",value:"bbt1.jpg"},{label:"bbt2.jpg",value:"bbt2.jpg"},{label:"bbt3.jpg",value:"bbt3.jpg"},{label:"bbt4.jpg",value:"bbt4.jpg"},{label:"bbt5.jpg",value:"bbt5.jpg"}],faces:[{label:"SSD Mobilenet V1",value:"ssdMobilenetv1"},{label:"Tiny Face Detector",value:"tinyFaceDetector"}],options:null,inputImgEl:null,canvas:null,facesContainer:null}},watch:{selectvalue(e){this.drawImg=`/images/${e}`,setTimeout(()=>{this.updateResults()},0)},facevalue(e){this.fnInit(),this.updateResults()}},mounted(){this.$nextTick(()=>{this.fnInit().then(()=>this.updateResults())}),this.$message=E(),this.inputImgEl=document.getElementById("inputImg"),this.facesContainer=document.getElementById("facesContainer"),this.canvas=document.getElementById("overlay")},methods:{async fnInit(){switch(this.facevalue){case"ssdMobilenetv1":this.options=new v({minConfidence:.5});break;case"tinyFaceDetector":this.options=new g({inputSize:512,scoreThreshold:.5});break;case"mtcnn":this.options=new j({minFaceSize:20,scaleFactor:.709});break}},handleChange({event:e,file:t,fileList:a}){this.drawImg=URL.createObjectURL(t.file),this.updateResults(),this.fileList=a},handleUpdateChecked(e){this.checked=e,this.updateResults()},async clickConfirm(){if(this.imgUrl){let e=await this.requestExternalImage(this.imgUrl);this.drawImg=e.src,this.updateResults()}},getCurrentFaceDetectionNet(){if(this.facevalue==="ssdMobilenetv1")return _.ssdMobilenetv1;if(this.facevalue==="tinyFaceDetector")return _.tinyFaceDetector},isFaceDetectionModelLoaded(){return!!this.getCurrentFaceDetectionNet().params},getFaceDetectorOptions(){return this.facevalue==="ssdMobilenetv1"?new v({minConfidence:this.minConfidence}):new g({inputSize:this.inputSize,scoreThreshold:this.scoreThreshold})},async requestExternalImage(e){let t=await fetch(e);try{let a=await t.blob();return await D(a)}catch{throw new Error("failed to load image from url: "+e)}},displayExtractedFaces(e){const{canvas:t,inputImgEl:a,facesContainer:d}=this;b(t,a),d.innerHTML="",e.forEach(r=>{r.style.margin="10px",d.append(r)})},async updateResults(){if(!this.isFaceDetectionModelLoaded())return;const{canvas:e,inputImgEl:t}=this;e.getContext("2d").clearRect(0,0,e.width,e.height);const a=this.getFaceDetectorOptions(),d=await w(t,a),r=await M(t,d);this.displayExtractedFaces(r);const f=await w(t,a).withFaceLandmarks();e.width=t.width,e.height=t.height,b(e,t);let l=U(f,t);l.length?(this.checked||x(e,l),S(e,l)):this.$message.error("\u8FD9\u53EF\u80FD\u4E0D\u662F\u4E2A\u4EBA\uFF01")}}}),o=e=>(R("data-v-363f21de"),e=e(),$(),e),B={style:{position:"relative"},class:"margin"},N={style:{width:"300px","margin-right":"10px"}},V=o(()=>n("h4",null,"\u56FE\u7247\u8F93\u5165",-1)),q=o(()=>n("label",{for:""},"\u9009\u62E9\u4E00\u4E2A\u7167\u7247\u5427\uFF1A",-1)),A=h("\u6216\u8005"),H=o(()=>n("label",{for:""},"\u8F93\u5165\u4E00\u4E2A\u56FE\u7247\u94FE\u63A5\uFF1A",-1)),J=h("\u786E\u5B9A"),K=h("\u6216\u8005"),P=o(()=>n("label",{for:""},"\u4ECE\u672C\u5730\u9009\u4E00\u5F20\u56FE\u7247\uFF1A",-1)),Q=h("\u9009\u62E9\u6587\u4EF6"),W=o(()=>n("h4",null,"\u9009\u62E9\u4EBA\u8138\u68C0\u6D4B\u5668",-1)),G={style:{position:"relative"}},X=["src"],Y=o(()=>n("canvas",{id:"overlay"},null,-1)),Z=o(()=>n("div",{id:"facesContainer"},null,-1));function ee(e,t,a,d,r,f){const l=i("n-select"),p=i("n-divider"),I=i("n-input"),m=i("n-button"),y=i("n-upload"),C=i("n-checkbox"),k=i("n-space");return L(),T("div",B,[s(k,null,{default:c(()=>[n("div",N,[V,q,s(l,{value:e.selectvalue,"onUpdate:value":t[0]||(t[0]=u=>e.selectvalue=u),options:e.defaultImgs},null,8,["value","options"]),s(p,{"title-placement":"left"},{default:c(()=>[A]),_:1}),H,s(I,{value:e.imgUrl,"onUpdate:value":t[1]||(t[1]=u=>e.imgUrl=u),type:"text",placeholder:"\u56FE\u7247\u94FE\u63A5"},null,8,["value"]),s(m,{onClick:e.clickConfirm},{default:c(()=>[J]),_:1},8,["onClick"]),s(p,{"title-placement":"left"},{default:c(()=>[K]),_:1}),P,s(y,{onChange:e.handleChange,"default-upload":!1,ref:"upload"},{default:c(()=>[s(m,null,{default:c(()=>[Q]),_:1})]),_:1},8,["onChange"]),s(p,{"title-placement":"left"}),W,s(l,{value:e.facevalue,"onUpdate:value":t[2]||(t[2]=u=>e.facevalue=u),options:e.faces},null,8,["value","options"]),s(C,{style:{"margin-top":"10px"},"onUpdate:checked":e.handleUpdateChecked,label:"\u9690\u85CF\u8FB9\u754C\u6846"},null,8,["onUpdate:checked"])]),n("div",G,[n("img",{id:"inputImg",style:{width:"100%",border:"0"},src:e.drawImg},null,8,X),Y,Z])]),_:1})])}var ae=O(z,[["render",ee],["__scopeId","data-v-363f21de"]]);export{ae as default};
