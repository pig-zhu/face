import{d as C,I as k,M as I,T as m,S as v,n as _,K as F,L as R,O as T,P as V,r as a,v as D,f as s,w as o,o as S,x as i,V as c,a1 as M,Q as U,U as O}from"./vendor.788096f7.js";import{_ as z}from"./index.2b50ce85.js";const L=C({name:"video-face-tracking",data(){return{videoPlay:!1,showModal:!0,showLoading:!1,checked:!1,minConfidence:.5,scoreThreshold:.5,inputSize:512,imgUrl:"",drawImg:"/media/test.mp4",facevalue:"ssdMobilenetv1",faces:[{label:"SSD Mobilenet V1",value:"ssdMobilenetv1"},{label:"Tiny Face Detector",value:"tinyFaceDetector"}],options:null,inputVideo:null,canvas:null,timeout:null}},watch:{facevalue(e){this.fnInit(),this.updateResults()}},mounted(){this.$nextTick(()=>{this.fnInit()}),this.$message=k(),this.inputVideo=document.getElementById("inputVideo"),this.canvas=document.getElementById("overlay")},methods:{play(){this.inputVideo.paused?(this.inputVideo.play(),this.videoPlay=!0,setTimeout(()=>this.updateResults(),100)):(this.videoPlay=!1,this.inputVideo.pause())},async fnInit(){switch(this.facevalue){case"ssdMobilenetv1":this.options=new v({minConfidence:.5});break;case"tinyFaceDetector":this.options=new m({inputSize:512,scoreThreshold:.5});break;case"mtcnn":this.options=new I({minFaceSize:20,scaleFactor:.709});break}},handleChange({event:e,file:t,fileList:n}){this.drawImg=URL.createObjectURL(t.file),this.updateResults(),this.fileList=n},handleUpdateChecked(e){this.checked=e,this.updateResults()},async clickConfirm(){if(this.videoPlay=!1,this.inputVideo.pause(),this.canvas.getContext("2d").clearRect(0,0,this.canvas.width,this.canvas.height),this.imgUrl){let e=await this.requestExternalImage(this.imgUrl);this.drawImg=URL.createObjectURL(e),this.updateResults()}},getCurrentFaceDetectionNet(){if(this.facevalue==="ssdMobilenetv1")return _.ssdMobilenetv1;if(this.facevalue==="tinyFaceDetector")return _.tinyFaceDetector},getFaceDetectorOptions(){return this.facevalue==="ssdMobilenetv1"?new v({minConfidence:this.minConfidence}):new m({inputSize:this.inputSize,scoreThreshold:this.scoreThreshold})},async requestExternalImage(e){let t=await fetch(e);try{return await t.blob()}catch{throw new Error("failed to load image from url: "+e)}},async updateResults(){const{canvas:e,inputVideo:t}=this;if(t.paused)return clearTimeout(this.timeout);const n=this.getFaceDetectorOptions(),h=await F(t,n),p=R(e,t,!0),d=T(h,p);d.length&&V(e,d),this.timeout=setTimeout(()=>this.updateResults())}}}),l=e=>(U("data-v-12beb331"),e=e(),O(),e),E={style:{position:"relative"},class:"margin"},P={style:{width:"300px","margin-right":"10px"}},$=l(()=>i("h4",null,"\u89C6\u9891\u8F93\u5165",-1)),x=l(()=>i("label",{for:""},"\u8F93\u5165\u4E00\u4E2A\u89C6\u9891\u94FE\u63A5\uFF1A",-1)),B=c("\u786E\u5B9A"),j=c("\u6216\u8005"),N=l(()=>i("label",{for:""},"\u4ECE\u672C\u5730\u9009\u4E00\u4E2A\u89C6\u9891\uFF1A",-1)),q=c("\u9009\u62E9\u6587\u4EF6"),A=l(()=>i("h4",null,"\u9009\u62E9\u4EBA\u8138\u68C0\u6D4B\u5668",-1)),K=l(()=>i("h4",null,"\u89C6\u9891\u63A7\u5236",-1)),Q={style:{position:"relative"}},G=["src"],H=l(()=>i("canvas",{id:"overlay"},null,-1));function J(e,t,n,h,p,d){const g=a("n-input"),u=a("n-button"),f=a("n-divider"),y=a("n-upload"),b=a("n-select"),w=a("n-space");return S(),D("div",E,[s(w,null,{default:o(()=>[i("div",P,[$,x,s(g,{value:e.imgUrl,"onUpdate:value":t[0]||(t[0]=r=>e.imgUrl=r),type:"text",placeholder:"\u89C6\u9891\u94FE\u63A5"},null,8,["value"]),s(u,{onClick:e.clickConfirm},{default:o(()=>[B]),_:1},8,["onClick"]),s(f,{"title-placement":"left"},{default:o(()=>[j]),_:1}),N,s(y,{onChange:e.handleChange,"default-upload":!1,ref:"upload"},{default:o(()=>[s(u,null,{default:o(()=>[q]),_:1})]),_:1},8,["onChange"]),s(f,{"title-placement":"left"}),A,s(b,{value:e.facevalue,"onUpdate:value":t[1]||(t[1]=r=>e.facevalue=r),options:e.faces},null,8,["value","options"]),K,s(u,{onClick:e.play},{default:o(()=>[c(M(e.videoPlay?"\u6682\u505C\u64AD\u653E":"\u5F00\u59CB\u64AD\u653E"),1)]),_:1},8,["onClick"])]),i("div",Q,[i("video",{id:"inputVideo",src:e.drawImg,muted:"",playsinline:""},null,8,G),H])]),_:1})])}var Y=z(L,[["render",J],["__scopeId","data-v-12beb331"]]);export{Y as default};
