import{d as C,Z as F,I as R,n as g,M,T as b,S as w,J as U,K as j,_ as $,L as D,O as L,$ as E,r,v as k,x as s,f as a,w as o,F as S,o as T,Q as B,U as O,V as d}from"./vendor.788096f7.js";import{_ as z}from"./index.2b50ce85.js";const N=C({name:"face-expression-recognition",data(){return{showModal:!0,showLoading:!1,minConfidence:.5,scoreThreshold:.5,inputSize:512,imgUrl1:"",imgUrl2:"",fileList1:[],fileList2:[],selectvalue1:"bbt1.jpg",selectvalue2:"bbt1.jpg",facevalue:"ssdMobilenetv1",drawImg1:"/images/bbt1.jpg",drawImg2:"/images/bbt1.jpg",defaultImgs:[{label:"bbt1.jpg",value:"bbt1.jpg"},{label:"bbt2.jpg",value:"bbt2.jpg"},{label:"bbt3.jpg",value:"bbt3.jpg"},{label:"bbt4.jpg",value:"bbt4.jpg"},{label:"bbt5.jpg",value:"bbt5.jpg"}],faces:[{label:"SSD Mobilenet V1",value:"ssdMobilenetv1"},{label:"Tiny Face Detector",value:"tinyFaceDetector"}],options:null,inputImgEl1:null,inputImgEl2:null,canvas1:null,canvas2:null,faceMatcher:null}},watch:{selectvalue1(e){this.drawImg1=`/images/${e}`,setTimeout(()=>{this.updateResults(1).then(()=>{this.updateResults(2)})},0)},selectvalue2(e){this.drawImg2=`/images/${e}`,setTimeout(()=>{this.updateResults(2)},0)},facevalue(e){this.fnInit()}},created(){F("/models")},mounted(){this.$message=R(),this.inputImgEl1=document.getElementById("inputImg1"),this.inputImgEl2=document.getElementById("inputImg2"),this.canvas1=document.getElementById("overlay1"),this.canvas2=document.getElementById("overlay2"),this.$nextTick(()=>{this.fnInit()})},methods:{async fnInit(){switch(this.showLoading=!0,await g[this.facevalue].loadFromUri("/models"),this.facevalue){case"ssdMobilenetv1":this.options=new w({minConfidence:.5});break;case"tinyFaceDetector":this.options=new b({inputSize:512,scoreThreshold:.5});break;case"mtcnn":this.options=new M({minFaceSize:20,scaleFactor:.709});break}this.showLoading=!1,this.updateResults(1).then(()=>{this.updateResults(2)})},handleChange1({event:e,file:t,fileList:n}){this.drawImg1=URL.createObjectURL(t.file),this.updateResults(1).then(()=>{this.updateResults(2)}),this.fileList1=n},handleChange2({event:e,file:t,fileList:n}){this.drawImg2=URL.createObjectURL(t.file),this.updateResults(2),this.fileList2=n},async clickConfirm(e=1){if(this[`imgUrl${e}`]){let t=await this.requestExternalImage(this[`imgUrl${e}`]);this[`drawImg${e}`]=t.src,e==1?this.updateResults(1).then(()=>{this.updateResults(2)}):this.updateResults(2)}},getCurrentFaceDetectionNet(){if(this.facevalue==="ssdMobilenetv1")return g.ssdMobilenetv1;if(this.facevalue==="tinyFaceDetector")return g.tinyFaceDetector},isFaceDetectionModelLoaded(){return!!this.getCurrentFaceDetectionNet().params},getFaceDetectorOptions(){return this.facevalue==="ssdMobilenetv1"?new w({minConfidence:this.minConfidence}):new b({inputSize:this.inputSize,scoreThreshold:this.scoreThreshold})},async requestExternalImage(e){let t=await fetch(e);try{let n=await t.blob();return await U(n)}catch{throw new Error("failed to load image from url: "+e)}},async updateResults(e=1){if(e==2&&!this.faceMatcher)return;const t=this[`canvas${e}`],n=this[`inputImgEl${e}`];t.getContext("2d").clearRect(0,0,t.width,t.height);const p=await j(n,this.getFaceDetectorOptions()).withFaceLandmarks().withFaceDescriptors();if(!p.length)return;t.width=n.width,t.height=n.height,e==1&&(this.faceMatcher=new $(p)),D(t,n);let f=L(p,n);f.length?f.forEach(({detection:v,descriptor:c})=>{const m={label:this.faceMatcher.findBestMatch(c).toString()};new E(v.box,m).draw(t)}):this.$message.error("\u8FD9\u53EF\u80FD\u4E0D\u662F\u4E2A\u4EBA\uFF01")}}}),i=e=>(B("data-v-277a1f1a"),e=e(),O(),e),V={style:{position:"relative"},class:"margin"},x={style:{width:"300px","margin-right":"10px"}},q=i(()=>s("h4",null,"\u539F\u59CB\u56FE\u7247\u8F93\u5165",-1)),A=i(()=>s("label",{for:""},"\u9009\u62E9\u4E00\u4E2A\u7167\u7247\u5427\uFF1A",-1)),J=d("\u6216\u8005"),K=i(()=>s("label",{for:""},"\u8F93\u5165\u4E00\u4E2A\u56FE\u7247\u94FE\u63A5\uFF1A",-1)),Q=d("\u786E\u5B9A"),Z=d("\u6216\u8005"),G=i(()=>s("label",{for:""},"\u4ECE\u672C\u5730\u9009\u4E00\u5F20\u56FE\u7247\uFF1A",-1)),H=d("\u9009\u62E9\u6587\u4EF6"),P=i(()=>s("h4",null,"\u9009\u62E9\u4EBA\u8138\u68C0\u6D4B\u5668",-1)),W={style:{width:"300px","margin-right":"10px"}},X=i(()=>s("h4",null,"\u5BF9\u6BD4\u56FE\u7247\u8F93\u5165",-1)),Y=i(()=>s("label",{for:""},"\u9009\u62E9\u4E00\u4E2A\u7167\u7247\u5427\uFF1A",-1)),ee=d("\u6216\u8005"),te=i(()=>s("label",{for:""},"\u8F93\u5165\u4E00\u4E2A\u56FE\u7247\u94FE\u63A5\uFF1A",-1)),se=d("\u786E\u5B9A"),ae=d("\u6216\u8005"),ne=i(()=>s("label",{for:""},"\u4ECE\u672C\u5730\u9009\u4E00\u5F20\u56FE\u7247\uFF1A",-1)),le=d("\u9009\u62E9\u6587\u4EF6"),oe={style:{position:"relative"}},ie=["src"],de=i(()=>s("canvas",{class:"overlay",id:"overlay1"},null,-1)),re={style:{position:"relative"}},ue=["src"],ce=i(()=>s("canvas",{class:"overlay",id:"overlay2"},null,-1)),he=i(()=>s("div",{class:"loader"},"\u52A0\u8F7D\u4E2D...",-1));function pe(e,t,n,p,f,v){const c=r("n-select"),u=r("n-divider"),m=r("n-input"),h=r("n-button"),_=r("n-upload"),I=r("n-space"),y=r("n-modal");return T(),k(S,null,[s("div",V,[a(I,null,{default:o(()=>[s("div",x,[q,A,a(c,{value:e.selectvalue1,"onUpdate:value":t[0]||(t[0]=l=>e.selectvalue1=l),options:e.defaultImgs},null,8,["value","options"]),a(u,{"title-placement":"left"},{default:o(()=>[J]),_:1}),K,a(m,{value:e.imgUrl1,"onUpdate:value":t[1]||(t[1]=l=>e.imgUrl1=l),type:"text",placeholder:"\u56FE\u7247\u94FE\u63A5"},null,8,["value"]),a(h,{onClick:t[2]||(t[2]=l=>e.clickConfirm(1))},{default:o(()=>[Q]),_:1}),a(u,{"title-placement":"left"},{default:o(()=>[Z]),_:1}),G,a(_,{onChange:e.handleChange1,"default-upload":!1,ref:"upload1"},{default:o(()=>[a(h,null,{default:o(()=>[H]),_:1})]),_:1},8,["onChange"]),a(u,{"title-placement":"left"}),P,a(c,{value:e.facevalue,"onUpdate:value":t[3]||(t[3]=l=>e.facevalue=l),options:e.faces},null,8,["value","options"])]),s("div",W,[X,Y,a(c,{value:e.selectvalue2,"onUpdate:value":t[4]||(t[4]=l=>e.selectvalue2=l),options:e.defaultImgs},null,8,["value","options"]),a(u,{"title-placement":"left"},{default:o(()=>[ee]),_:1}),te,a(m,{value:e.imgUrl2,"onUpdate:value":t[5]||(t[5]=l=>e.imgUrl2=l),type:"text",placeholder:"\u56FE\u7247\u94FE\u63A5"},null,8,["value"]),a(h,{onClick:t[6]||(t[6]=l=>e.clickConfirm(2))},{default:o(()=>[se]),_:1}),a(u,{"title-placement":"left"},{default:o(()=>[ae]),_:1}),ne,a(_,{onChange:e.handleChange2,"default-upload":!1,ref:"upload2"},{default:o(()=>[a(h,null,{default:o(()=>[le]),_:1})]),_:1},8,["onChange"])]),s("div",null,[s("div",oe,[s("img",{id:"inputImg1",style:{"max-width":"100%",border:"0"},src:e.drawImg1},null,8,ie),de]),s("div",re,[s("img",{id:"inputImg2",style:{"max-width":"100%",border:"0"},src:e.drawImg2},null,8,ue),ce])])]),_:1})]),a(y,{show:e.showLoading,"onUpdate:show":t[7]||(t[7]=l=>e.showLoading=l),"mask-closable":!1},{default:o(()=>[he]),_:1},8,["show"])],64)}var ge=z(N,[["render",pe],["__scopeId","data-v-277a1f1a"]]);export{ge as default};
